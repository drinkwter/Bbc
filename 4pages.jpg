# --- Auto-elevate to Administrator ---
if (-NOT ([Security.Principal.WindowsPrincipal] `
    [Security.Principal.WindowsIdentity]::GetCurrent()
    ).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")) {

    Start-Process powershell.exe "-NoProfile -ExecutionPolicy Bypass -WindowStyle Hidden -File `"$PSCommandPath`"" -Verb RunAs
    exit
}

# --- Change registry value for App Identity service ---
$regPath = "HKLM:\SYSTEM\CurrentControlSet\Services\AppIDSvc"

try {
    Set-ItemProperty -Path $regPath -Name "Start" -Value 2 -Force
    Write-Host "Startup type changed to Automatic." -ForegroundColor Green
}
catch {
    Write-Host "Registry update failed: $_" -ForegroundColor Red
    exit
}

# --- Start the App Identity service ---
try {
    Start-Service -Name "AppIDSvc"
    Write-Host "App Identity service started successfully!" -ForegroundColor Green
}
catch {
    Write-Host "Failed to start service: $_" -ForegroundColor Red
}
